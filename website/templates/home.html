{% extends 'base.html' %}

{% block content %}



{% if user.is_authenticated %}





<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-1 sidebar align-items-center">
      <div class="d-flex flex-column gap-2 align-items-center">
    
        <img src="https://cdn-icons-png.flaticon.com/512/219/219986.png" style="width: 50px; height: 50px;" alt="Profile" class="rounded-circle">
        
      </div>
      <div class="sidebar-icon"><i class="bi bi-list"></i></div>
      <div class="sidebar-icon"><i class="bi bi-clock"></i></div>
      <div class="sidebar-icon"><i class="bi bi-gear"></i></div>
    </div>

    <!-- Main Content -->
    <div class="col-md-8 px-4">
      <!-- Search and Profile -->
      <div class="d-flex justify-content-between align-items-center mt-4">
          <div class="input-group w-50">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" class="form-control" placeholder="Search menu...">
            </div>
            

        <div class="d-flex align-items-center">
         <button class="btn btn-outline-dark border-0" type="submit" data-bs-toggle="dropdown">
            <i class="bi-cart-fill me-1"></i>
            Cart
            <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart-qty">{{cart|length}}</span>
        </button>
        </div>
       
          
    
      </div>

      <!-- Categories -->
      <h5 class="mt-4">Choose Category</h5>
      <div class="d-flex gap-2">
          <button class="category-btn active" onclick="setActiveCategory(event, 'Popular Menu')">Popular</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Ice Cream')">Ice Cream</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Rice Bowl')">Rice Bowl</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Coffee')">Coffee</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Snack')">Snack</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Dessert')">Dessert</button>
          <button class="category-btn" onclick="setActiveCategory(event, 'Salad')">Salad</button>
        </div>

      <!-- Menu Section -->
      <h5 class="mt-4" id="selected_category">Popular Menu</h5>
      <div class="row g-4">



<!-- Product Cards -->
{% if products %}
{% for  product in products %}  
          <!-- display product  -->
        <div class="col-md-4" onclick="setVariant(event,1)">
          <div class="card" data-id="1">
            <img src={{product.description}} class="card-img-top" alt="Thai Rice Bowl">
            <div class="card-body">
              <h6 class="card-title">{{product.name}}</h6>
              <p>â‚±{{product.price}} / item</p>

              <!-- product variants -->
              <div class="container d-none poduct_variant" id="poduct_variant">
                  <div class="row ">
                    <!-- First Column -->
                    <div class="col-6" style="font-size: 10px; padding: 0;">
                      <label for="">Spicy Level</label>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                        <label class="form-check-label" for="exampleRadios1" style="font-size: 10px; padding: 0; margin: 0;">Mild</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2">
                        <label class="form-check-label" for="exampleRadios2">Medium</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="option3" disabled>
                        <label class="form-check-label" for="exampleRadios3">Extra Hot</label>
                      </div>
                    </div>
                
                    <!-- Second Column -->
                    <div class="col-6" style="font-size: 10px; padding: 0;">
                      <label for="">Add Ons</label>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                        <label class="form-check-label" for="defaultCheck1">Checkin wing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="defaultCheck2" disabled>
                        <label class="form-check-label" for="defaultCheck2">Hotdog</label>
                      </div>
                    </div>
                  </div> <!-- End of row -->
                
                  <!-- Third Column (Moves to Next Row) -->
                  <div class="row ">
                    <div class="col-6" style="font-size: 10px; padding: 0;">
                      <label for="">Size</label>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                        <label class="form-check-label" for="exampleRadios1" style="font-size: 10px; padding: 0; margin: 0;">Mild</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2">
                        <label class="form-check-label" for="exampleRadios2">Medium</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="option3" disabled>
                        <label class="form-check-label" for="exampleRadios3">Extra Hot</label>
                      </div>
                    </div>
                  </div> <!-- End of row -->
                </div>
              <!-- <button class="btn btn-danger btn-sm w-100" id="more">More</button> -->

              <button class="btn btn-danger btn-sm w-100" type="button" value="{{product.id}}" id="add-cart">Add to Cart</button>
              
            </div>
          </div>
        </div>


{% endfor %}
{% endif %}
        
      </div>
    </div>



    <!-- Billing Section -->
    <div class="col-md-3  poppins-regular" style="box-sizing: border-box;">
      <div class="billing-card" style="box-sizing: border-box;">
        <h6>Items</h6>

        <div id="list-group">
      {% if cart %}
      {% for  cartItemKey, cartItemValue in cart.cart.items %}  
        <!-- billing items added here  -->
        <div class="d-flex justify-content-between align-items-center w-100 position-relative overflow-visible" style="box-sizing: border-box; overflow: hidden; margin-bottom: .5rem;">
          <button type="button" class="btn-close position-absolute border-2 rounded-circle" style="font-size: 0.75rem; border-color: #007bff;z-index: 999; left: -7px; top: -4px;" data-bs-dismiss="card" aria-label="Close" value="{{cartItemValue.id}}" id="delete-cart"></button>
          <img src={{cartItemValue.imageUrl}} style="width: 40px; height: 40px; border-radius: 9px; background-color: red;"  alt="" srcset="">
          <div class=" w-100 justify-content-between align-items-center gap-2" style="margin-left: 1rem; overflow: hidden; padding: 0; font-size: 12px;">
              <div class="text-nowrap" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%;">{{cartItemValue.name}}</div>
              <small class="text-muted">{{cartItemValue.name}}</small>
          </div>
          <div class="">
              <div class="text-nowrap d-flex justify-content-end font-weight-bold">P {{cartItemValue.price}}</div>
              <div class="text-nowrap d-flex justify-content-end">
                  <div class="d-flex gap-2">
                      <!-- Minus Button -->
                      <button class="w-auto h-auto d-flex align-items-center justify-content-center bg-light rounded-lg p-2" type="button" value="{{cartItemValue.id}}" id="update-cart-subtract">
                        <i style="font-size: 7px;" class="fas fa-minus text-muted"></i>
                      </button>
                    
                      <!-- Number -->
                      <span class="d-flex align-items-center " style="font-size: 12px;" id="qty_element{{cartItemValue.id}}">{{cartItemValue.p_qty}}</span>
                    
                      <!-- Plus Button -->
                      <button class="w-auto h-auto d-flex align-items-center justify-content-center bg-danger rounded-lg p-2" type="button" value="{{cartItemValue.id}}" id="update-cart-add">
                        <i style="font-size: 7px;" class="fa-solid fa-plus text-white"></i>
                      </button>
                    </div>
              </div>
          </div>
      </div>
      {% endfor %}
      {% endif %}
        </div>

      <!-- Billing info  -->

      
      <hr>
        <div class="d-flex justify-content-between">
          <p>Subtotal</p>

          <p class="text-muted" id="running_total">P {{cart.running_total}}</p>




        </div>
        <div class="d-flex justify-content-between">
          <p>Discount</p>
          <p class="text-muted">- 0.00</p>
        </div>
        <div class="d-flex justify-content-between">
          <p>Tax</p>
          <p class="text-muted">- 0.00</p>
        </div>
        <hr>
        <div class="d-flex justify-content-between fw-bold">
          <p>Total</p>
          <p id="grand_total">P {{cart.running_total}}</p>
        </div>
        <h6 class="mt-4">Payment Method</h6>
        <div class="d-flex gap-2 align-items-center justify-content-center">

          
          <button class="btn btn-outline-secondary w-40">
              <div><i class="fa-solid fa-money-check-dollar"></i></div>
              <div style="font-size: 5px;">Debit Card</div>
          </button>
          <button class="btn btn-outline-danger w-40">
              <div>
                  
              </div>
              <div><i class="fa-regular fa-credit-card"></i></div>
              <div style="font-size: 5px;">Debit Card</div>
          </button>


        </div>
        <button class="btn btn-danger w-100 mt-3">Add to Billing</button>
      
       
     
        


      </div>
    </div>
  </div>
</div>










<script>


const reloadCart=(json)=>{
document.getElementById('cart-qty').textContent=json.qty
      let innerHTML=``

      JSON.parse(json.cart).forEach(cartItem => {

          innerHTML+=`
        <!-- billing items added here  -->
        <div class="d-flex justify-content-between align-items-center w-100 position-relative overflow-visible" style="box-sizing: border-box; overflow: hidden; margin-bottom: .5rem;" id:"bill-item">
          <button type="button" class="btn-close position-absolute border-2 rounded-circle" style="font-size: 0.75rem;border-color: #007bff;z-index: 999; left: -7px; top: -4px;" data-bs-dismiss="card" aria-label="Close" value=${cartItem.id} id="delete-cart"></button>
          <img src=${cartItem.imageUrl} style="width: 40px; height: 40px; border-radius: 9px; background-color: red;"  alt="" srcset="">
          <div class=" w-100 justify-content-between align-items-center gap-2" style="margin-left: 1rem; overflow: hidden; padding: 0; font-size: 12px;">
              <div class="text-nowrap" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60%;">${cartItem.name}</div>
              <small class="text-muted">${cartItem.name}</small>
          </div>
          <div class="">
              <div class="text-nowrap d-flex justify-content-end font-weight-bold">P ${cartItem.price}</div>
              <div class="text-nowrap d-flex justify-content-end">
                  <div class="d-flex gap-2">
                      <!-- Minus Button -->
                      <button class="w-auto h-auto d-flex align-items-center justify-content-center bg-light rounded-lg p-2" value=${cartItem.id} id="update-cart-subtract">
                        <i style="font-size: 7px;" class="fas fa-minus text-muted"></i>
                      </button>
                    
                      <!-- Number -->
                      <span class="d-flex align-items-center " style="font-size: 12px;" id="qty_element${cartItem.id}">${cartItem.p_qty}</span>
                    
                      <!-- Plus Button -->
                      <button class="w-auto h-auto d-flex align-items-center justify-content-center bg-danger rounded-lg p-2" value=${cartItem.id} id="update-cart-add">
                        <i style="font-size: 7px;" class="fa-solid fa-plus text-white"></i>
                      </button>
                    </div>
              </div>
          </div>
      </div>
      `
          
      });

      
      document.getElementById('list-group').innerHTML=innerHTML

      document.getElementById('running_total').innerHTML=`P ${json.running_total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`
      document.getElementById('grand_total').innerHTML=`P ${json.running_total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`

}

$(document).on('click', '#add-cart', function(e){
e.preventDefault();
$.ajax({
  type:'POST',
  url:"{%url 'cart_add' %}",
  data:{
      product_id: $(this).val(),
      csrfmiddlewaretoken:'{{csrf_token}}',
      action:'post'
  },
  success:function(inputJson){
      reloadCart(inputJson)
      
  },
  error:function(xhr,errmsg,err)
  {

  }
})
});

$(document).on('click', '#delete-cart', function(e){
e.preventDefault();
$.ajax({
  type:'POST',
  url:"{%url 'cart_delete' %}",
  data:{
      product_id: $(this).val(),
      csrfmiddlewaretoken:'{{csrf_token}}',
      action:'post'
  },
  success:function(inputJson){
      reloadCart(inputJson)
      
  },
  error:function(xhr,errmsg,err)
  {

  }
})
});

$(document).on('click', '#update-cart-subtract', function(e){
e.preventDefault();

$.ajax({
  type:'POST',
  url:"{%url 'cart_update' %}",
  data:{
      product_id: $(this).val(),
      
      new_qty:parseInt(document.getElementById(`qty_element${$(this).val()}`).innerText)-1,
      csrfmiddlewaretoken:'{{csrf_token}}',
      action:'post'
  },
  success:function(inputJson){
      reloadCart(inputJson)
      
  },
  error:function(xhr,errmsg,err)
  {

  }
})
});

$(document).on('click', '#update-cart-add', function(e){
e.preventDefault();

$.ajax({
  type:'POST',
  url:"{%url 'cart_update' %}",
  data:{
      product_id: $(this).val(),
      new_qty:parseInt(document.getElementById(`qty_element${$(this).val()}`).innerText)+1,
      csrfmiddlewaretoken:'{{csrf_token}}',
      action:'post'
  },
  success:function(inputJson){
      reloadCart(inputJson)
      
  },
  error:function(xhr,errmsg,err)
  {

  }
})
});



</script>


{% else %}

<div class="container">
<div class="col-md-6 offset-md-3">
<h1>Login</h1>
<br/>

<form method="POST" action="{% url '/' %}">
	{% csrf_token %}

  <div class="mb-3">
    <input type="text" class="form-control" name="username", placeholder="Username" required>
    
  </div><br/>
  <div class="mb-3">
    <input type="password" class="form-control" name="password", placeholder="Password" required>
  </div>
  <br/>
  <button type="submit" class="btn btn-secondary">Login</button>

</form>
</div>
</div>


{% endif %}

{% endblock %}

